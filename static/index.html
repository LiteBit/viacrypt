<!DOCTYPE html>
<html>
<head>
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script>
function generate_passphrase() {
	var choices = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
	var ret = [];
	for (var i=0; i<24; i++) {
		var idx = Math.floor(Math.random() * choices.length);
		ret.push(choices[idx]);
	}
	return ret.join('');
}
$(function() {
	$('#save').click(function() {
		var message = $('#message').val();
		var passphrase = generate_passphrase();
		var data = CryptoJS.AES.encrypt(message, passphrase);
		var content = {
			data: data.toString()
		};
		$.post('/m/', content, function(res) {
			var data = $.parseJSON(res);
			var id = data.id;
			var baseurl = 'http://localhost:8000';
			var url = baseurl + '/m/' + id + '#' + passphrase;
			console.log(url);
		});
	});
});
</script>
</head>

<body>

<div class="container">
	<h1>ViaCRYPT
		<small>One time read messaging system</small>
	</h1>
	<form class="form-horizontal">
		<div class="control-group">
			<label class="control-label" for="message">Message</label>
			<div class="controls">
				<textarea id="message" class="input-xxlarge" rows="15">
Testando :)
Linha 1
Linha 2
				</textarea>
			</div>
		</div>
		<div class="control-group">
			<div class="controls">
				<button id="save" type="button" class="btn btn-primary">Save it</button>
			</div>
		</div>
	</form>
</div>

</body>
</html>
